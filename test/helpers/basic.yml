default:
  context:
    lang: 'en'
    visitor: 'ant'
    node: 'status'
  src: "simple text"
  tem: "simple text"
  res: "simple text"

nasty_erb:
  src: "this <% puts \"could be\" %> nasty"
  tem: "this &lt;% puts \"could be\" %&gt; nasty"

never_end_erb:
  src: "never ending erb  <%= puts "
  tem: "never ending erb  &lt;%= puts "
  res: "never ending erb  &lt;%= puts "

nasty_evil_erb:
  src: "this <% puts <% puts 'could be' %> %> nasty"
  tem: "this &lt;% puts &lt;% puts 'could be' %&gt; %&gt; nasty"

trick_erb:
  src: "this <<z:void/>% puts 'is bad' %>"
  tem: "this <<z:void/>% puts 'is bad' %&gt;"
  res: "this <<z:void/>% puts 'is bad' %&gt;"
  
include_erb:
  src: "include: <z:include template='/nasty_erb'/>"
  tem: "include: this &lt;% puts \"could be\" %&gt; nasty"

cache_part:
  src: "<z:cache><z:show attr='name'/></z:cache>"
  tem: "<% cache1 = Cache.with(visitor.id, visitor.group_ids, \"en\", \"NP\", \"/cache/part\") do capture do %><%= @node.name %><% end; end %><%= cache1 %>"

show_title:
  src: "<z:show attr='v_title'/>"
  tem: "<%= @node.version.title %>"
  res: "status title"

trans:
  context:
    lang: 'fr'
  src: "<z:trans>Monday</z:trans> <z:trans text='Monday'/>"
  tem: "lundi lundi"
  res: "lundi lundi"

trans_show:
  context:
    lang: 'fr'
  src: "<z:trans><z:show attr='ref_lang'/></z:trans>"
  tem: "<%= trans(@node.ref_lang) %>"
  res: "anglais"

trans_attr:
  context:
    lang: 'en'
  src: "<z:trans attr='ref_lang'/>"
  tem: "<%= trans(@node.ref_lang) %>"
  res: "english"
  
show_tattr:
  src: "<z:show tattr='ref_lang'/>"
  tem: "<%= trans(@node.ref_lang) %>"
  res: "english"

link:
  src: "<z:link/>"
  tem: "<%= node_link(:node=>@node) %>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>status title</a>"

zafu_link:
  src: "<li do='link'/>"
  res: "<li><a href='/oo/projects/cleanWater/page22.html'>status title</a></li>"

link_attr:
  src: "<z:link attr='ref_lang'/>"
  tem: "<%= node_link(:node=>@node, :text=>@node.ref_lang) %>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>en</a>"

link_tattr:
  src: "<z:link tattr='ref_lang'/>"
  tem: "<%= node_link(:node=>@node, :text=>trans(@node.ref_lang)) %>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>english</a>"

link_trans:
  context:
    lang: 'fr'
  src: "<z:link trans='Monday'/>"
  tem: "<%= node_link(:node=>@node, :text=>\"lundi\") %>"
  res: "<a href='/oo/projects/cleanWater/page22.html'>lundi</a>"

link_parent:
  src: "<z:link href='parent' text='click here'/>"
  tem: "<%= node_link(:node=>@node, :text=>\"click here\", :href=>\"parent\") %>"
  res: "<a href='/oo/projects/cleanWater.html'>click here</a>"

link_with_block:
  src: "<z:link href='parent'>click here</z:link>"
  tem: "<%= node_link(:node=>@node, :text=>\"click here\", :href=>\"parent\") %>"
  res: "<a href='/oo/projects/cleanWater.html'>click here</a>"
  
link_project:
  context:
    node: 'bird_jpg'
  src: "<z:link href='project'/>"
  tem: "<%= node_link(:node=>@node, :href=>\"project\") %>"
  res: "<a href='/oo/project29.html'>a wiki with zena</a>"

link_root:
  src: "<z:link href='root'/>"
  tem: "<%= node_link(:node=>@node, :href=>\"root\") %>"
  res: "<a href='/oo'>Zena the wild CMS</a>"

link_dash:
  src: "<z:link dash='true'/>"
  res: "<a href='#node22'>status title</a>"

anchor:
  src: "<z:anchor/>"
  res: "<a name='node22'></a>"

show_title_anchor:
  src: "<z:title anchor='true'/>"
  res: "<a name='node22'></a><span id='v_title22'>status title</span>"
  
show_attr_anchor:
  src: "<z:show attr='name' anchor='true'/>"
  res: "<a name='node22'></a>status"

link_version:
  context:
    node: 'opening'
  src: "<z:traductions><z:each join=', '><z:link tattr='lang' /></z:each></z:traductions>"
  res: "<a href='/oo/projects/cleanWater/post27.html?lang=en'>english</a>, <a href='/oo/projects/cleanWater/post27.html?lang=fr'>french</a>"
  
link_version_anchor_dash:
  context:
    node: 'opening'
  src: "<z:traductions><z:each join=', '><z:link tattr='lang' dash='true' anchor='true'/></z:each></z:traductions>"
  res: "<a name='version27.2'></a><a href='#version27.2'>english</a>, <a name='version27.1'></a><a href='#version27.1'>french</a>"
  
title:
  src: "<h2 do='title'>super titre</h2>"
  tem: "<h2><%= show_title(:node=>@node)%></h2>"
  res: "<h2><span id='v_title22'>status title</span></h2>"

title_link:
  src: "<h2 do='title' link='details'>super titre</h2>"
  tem: "<h2><%= show_title(:node=>@node, :link=>\"details\")%></h2>"
  res: "<h2><span id='v_title22'><a href='/oo/projects/cleanWater/page22_details.html'>status title</a></span></h2>"

title_link_format:
  src: "<h2 do='title' link='details.xml'>super titre</h2>"
  tem: "<h2><%= show_title(:node=>@node, :link=>\"details.xml\")%></h2>"
  res: "<h2><span id='v_title22'><a href='/oo/projects/cleanWater/page22_details.xml'>status title</a></span></h2>"

title_link_data:
  context:
    node: 'bird_jpg'
  src: "<h2 do='title' link='data'>super titre</h2>"
  res: "<h2><span id='v_title30'><a href='/oo/image30.jpg'>bird</a></span></h2>"

title_link_data_mode:
  context:
    node: 'bird_jpg'
  src: "<h2 do='title' link='pv.data'>super titre</h2>"
  res: "<h2><span id='v_title30'><a href='/oo/image30_pv.jpg'>bird</a></span></h2>"

show_parent_title:
  src: "<z:parent><h1 do='title'>parent title</h1></z:parent>"
  tem: "<% if var1 = @node.relation(\"parent\") -%><h1><%= show_title(:node=>var1)%></h1><% end -%>"
  res: "<h1><span id='v_title21'><a href='/oo/projects/cleanWater.html'>Clean Water project</a></span></h1>"

show_bad_attr:
  src: "my <z:show attr=':name'/>"
  res: "my "

show_name:
  src:  "my <z:show attr='name'/>"
  res: "my status"

show_v_text:
  src:  "my <z:show attr='v_text'/>"
  res: "my status text"

show_title_options:
  src: "<h1 class='title' do='title' status='true' actions='all'>dummy</h1>"
  tem: "<h1 class='title'><div class='s<%= @node.version.status %>'><%= show_title(:node=>@node) + node_actions(:node=>@node, :actions=>\"all\")%></div></h1>"
  res: "/<h1 class='title'><div class='s50'><span id='v_title22'>status title</span><span class='actions'><a.*/nodes/22/versions/1/edit.*/images/page_edit.png'.*/></a>.*</span></div></h1>/"

show_c_width:
  context:
    node: "bird_jpg"
  src:  "width = <z:show attr='c_width'/>"
  res: "width = 661"

javascripts:
  src: "<z:javascripts list='prototype,effects,zena'/>"
  tem: "/<script src.*/javascripts/prototype.js.*script src=.*effects.js.*zena.js/"

stylesheets:
  src: "<z:stylesheets list='zena,code,search'/>"
  tem: "/link href.*/stylesheets/zena.css.*text/css.*code.css.*text/css.*search.css.*Stylesheet/"

lang_links:
  src: "<div id='lang' do='lang_links'><a>en</a> | <b>fr</b></div>"
  tem: "<div id='lang'><%= lang_links(:node=>@node) %></div>"
  res: "/<div id='lang'><b>en.*\|.*test_render.*=fr/"

show_path:
  src: "<div id='path' do='show_path'><ul><li><a href='#'>first</a></li> / <li><a href='#'>second</a></li> / <li><a href='#' class='current'>here</a></li></ul></div>"
  tem: "<div id='path'><%= show_path(:node=>@node) %></div>"
  res: "/<div id='path'><ul class='path'><li>.*zena.*<li>.*oo/page18.html.*<li><.*/projects/cleanWater.*cleanWater</a>.*/oo/projects/cleanWater/page22.html.*class='current'>status</a>/"

uses_calendar:
  src: "<z:uses_calendar/>"
  tem: "/<script.*calendar.js.*calendar-setup.js.*calendar-en-utf8.js.*calendar-brown.css.*CDATA.*DEF_DATE_FORMAT.*%Y-%m-%d %H:%M.*FIRST_DAY.*0/"

flash_messages_both:
  src: "<z:flash_messages/>"
  tem: "/id.*messages.*notice.*flash.*notice.*error.*flash.*error/"
  res: "<div id='messages'></div>"
  
flash_messages_error:
  src: "<z:flash_messages show='error'/>"
  tem: "/id.*messages.*error.*flash.*error/"
  res: "<div id='messages'></div>"
  
flash_messages_notice:
  src: "<z:flash_messages show='notice'/>"
  tem: "/id.*messages.*notice.*flash.*notice/"
  res: "<div id='messages'></div>"
  
show_author_short:
  src: "<div class='subtitle' do='show_author'><b>SI</b> - 05.12</div>"
  tem: "<div class='subtitle'><b><%= @node.version.author.initials %></b> - <%= format_date(@node.version.updated_at, \"%m.%d\") %></div>"
  res: "<div class='subtitle'><b>SI</b> - 04.11</div>"

show_author_large:
  src: "<z:show_author size='large'/>"
  tem: "/posted by.*@node.author.fullname.*traduction by.*@node.version.author.fullname.*else.*modified by.*@node.version.author.fullname.*on.*@node.version.updated_at, \"%m.%d\"/"
  res: "posted by <b>Solenopsis Invicta</b> on 04.11."

each_traductions:
  src: "<z:traductions except='current'><ul><li do='each'><z:show attr='title'/></li></ul></z:traductions>"
  tem: "<% if list1 = @node.traductions(:conditions=>\"lang != 'en'\") -%><ul><% list1.each do |var1| -%><li><%= var1.title %></li><% end -%></ul><% end -%>"
  res: "<ul><li>Etat des travaux</li></ul>"

each_traductions_except_list:
  src: "<z:traductions except='en,ru'><ul><li do='each'><z:show attr='title'/></li></ul></z:traductions>"
  res: "<ul><li>Etat des travaux</li></ul>"

each_traductions_only_list:
  src: "<z:traductions only='en,ru'><ul><li do='each'><z:show attr='title'/></li></ul></z:traductions>"
  res: "<ul><li>status title</li></ul>"

case_when:
  src: "<z:case><z:when kind_of='Document'>this is a document</z:when><z:when klass='Page'>Page</z:when><z:when status='pub'>Pub</z:when>"
  tem: "<% if false -%><% elsif @node.kind_of?(Document) -%>this is a document<% elsif @node.class == Page -%>Page<% elsif @node.version.status == 50 -%>Pub<% end -%>"
  res: "Page"

case_when_else:
  src: "<z:case><z:when kind_of='Document'>Document</z:when><z:else>Not a document</z:else></z:case>"
  res: "Not a document"

case_when_test:
  src: "<z:case><z:when test='[id] &gt; 10'>one</z:when><z:when test='[v_updated_at] &gt; [updated_at]'>two</z:when></z:case>"
  res: "one"

case_when_evil_test:
  src: "<z:case><z:when test='1 == == [id]'>one</z:when><z:when test='system == \"date\"'>two</z:when><z:else>three</z:else></z:case>"
  res: "three"
  
case_ancestor:
  src: "<z:root><z:pages><z:each join=', '><z:case><z:when node='ancestor'><b><z:show attr='name'/></b></z:when><z:else><z:show attr='name'/></z:else></z:case></z:each></z:pages></z:root>"
  res: "collections, nature, people, <b>projects</b>, skins"

simple_each:
  src: "<z:children><z:each><z:show attr='name'/></z:each></z:children>"
  tem: "/.*if list1.*each.*var1.name/"
  res: ""
  
each_join:
  context:
    node: 'wiki'
  src: "<z:children><z:each join=', '><z:show attr='name'/></z:each></z:children>"
  res: "bird, flower"

edit_not_each:
  src: "<li class='blah'>this is a post <z:edit>edit post</z:edit></li>"
  tem: "/<li class='blah'>this is a post </li>/"

edit_each_no_form:
  src: "<z:each><li>blah <z:edit>do this and that</z:edit></li>"
  tem: "/<li>blah </li>"

each_add_with_form:
  context:
    node: 'wiki'
  src: "<z:children><z:each><li do='show' attr='name'>blah</li>\n</z:each><z:add><li>add new</li></z:add><z:form><li><form>this is the form</form></li></z:form></z:children>"
  res: "/<li>bird.*<li>flower.*<li.*list_add.*list_form.*toggle.*<li .*list_form.*style.*none.*Ajax.Request.*input type='hidden' name='template_url' value='/each/add/with/form/list'/"
  
each_edit_with_form:
  context:
    node: 'wiki'
  src: "<z:children><z:each><li><z:show attr='name'>blah</z:show> <z:edit>edit</z:edit></li>\n</z:each><z:form><li><form>this is the form</form></li></z:form></z:children>"
  res: "/<li id='/each/edit/with/form/list30'>bird <a href=\"#\" onclick=\"new Ajax.Request\('/nodes/30/edit\?template_url=%2Feach%2Fedit%2Fwith%2Fform%2Flist/"

set_attribute:
  src: "<div class='machin' do='void' set_class='node[id]'/><z:void set_class='s[v_status]i[id]'/>"
  res: "<div class='node22'></div><div class='s50i22'></div>"

set_attribute_with_inner:
  src: "<p set_id='node[id]' do='show' attr='name' set_class='s[v_status]'>some blah blah</p>"
  res: "<p class='s50' id='node22'>status</p>"

set_in_ztag:
  src: "<z:show attr='name' set_id='node[id]'/>"
  res: "<div id='node22'>status</div>"

each_join_html:
  context:
    node: 'wiki'
  src: "<z:children><z:each join='&lt;br/&gt;'><z:show attr='name'/></z:each></z:children>"
  res: "bird<br/>flower"

each_join_nasty_erb:
  context:
    node: 'wiki'
  src: "<z:children><z:each join='&lt;% puts \'nasty\' -%&gt;'><z:show attr='name'/></z:each></z:children>"
  res: "bird&lt;% puts 'nasty' -%&gt;flower"
  
img_no_image:
  src: "<z:img/>"
  tem: "<%= img_tag(@node, :mode=>\"std\") %>"
  res: ""

img_image:
  context:
    node: 'bird_jpg'
  src: "<z:img/><z:img mode='med'/>"
  res: "<img src='/oo/image30_std.jpg' width='440' height='400' alt='bird' class='std'/><img src='/oo/image30_med.jpg' width='205' height='186' alt='bird' class='med'/>"

img_href:
  context:
    node: 'bird_jpg'
  src: "<z:img link='self'/>"
  res: "<a href='/oo/image30.html'><img src='/oo/image30_std.jpg' width='440' height='400' alt='bird' class='std'/></a>"

img_src_id:
  src: "<z:img src='20'/>"
  res: "<img src='/oo/image30_std.jpg' width='440' height='400' alt='bird' class='std'/>"
  
test_children_plural:
  tem: "<%= 'children'.pluralize %>"
  res: "children"

each_do:
  context:
    node: 'wiki'
  src: "<z:children><z:each join=', ' do='show' attr='name'/></z:children>"
  res: "bird, flower"
  
parent_do:
  context:
    node: 'wiki'
  src: "<z:parent do='link'/>"
  res: "<a href='/oo/page18.html'>projects list</a>"

do_each:
  context:
    node: 'wiki'
  src: "<z:children do='each'><z:link/></z:children>"
  res: "<a href='/oo/image30.html'>bird</a><a href='/oo/image31.html'>flower</a>"

do_with_inner:
  context:
    node: 'wiki'
  src: "<ul do='children' do='each' tag='li'><z:show attr='name'/></ul>"
  res: "<ul><li>bird</li><li>flower</li></ul>"

do_each_do:
  context:
    node: 'wiki'
  src: "<ul do='children' do='each' tag='li' do='link'/>"
  res: "<ul><li><a href='/oo/image30.html'>bird</a></li><li><a href='/oo/image31.html'>flower</a></li></ul>"

ignore:
  src: "<z:ignore>I think this is not</z:ignore>cool!"
  res: "cool!"

do_ignore:
  context:
    node: 'wiki'
  src: "<ul do='ignore' do='children' do='each' tag='li'><z:link/></ul>"
  res: ""

name_title:
  src: "title: <h1 id='main' do='show' name='title' attr='name'>blah</h1>"
  res: "title: <h1 id='main'>status</h1>"

include_with:
  src: "include_with: <z:include template='/name/title'><h1 do='with' part='title' do='show' attr='id'/>"
  res: "include_with: title: <h1 id='main'>22</h1>"
  
comments:
  src: "<z:show_comments/>"
  tem: "<%= show_comments(:node=>@node) %>"
  res: "/<div class='comments' id='comments'>.*reply.*add/"

content_for_layout:
  src: "<z:content_for_layout>blah blah</z:content_for_layout>"
  tem: "<% if @content_for_layout -%><%= @content_for_layout %><% else -%>blah blah<% end -%>"
  res: "blah blah"

title_for_layout:
  src: "<z:title_for_layout>blah blih</z:title_for_layout>"
  tem: "<% if @title_for_layout -%><%= @title_for_layout %><% else -%>blah blih<% end -%>"
  res: "blah blih"

tada:
  context:
    node: 'opening'
  src: |
    <h1 id='main_title' do='show' attr='v_title'>Super project</h1>

    <ul do='tags'>
      <li do='each' do='link' attr='v_title'>art</li>
      <li do='ignore'>life</li>
      <li do='ignore'>ruby</li>
    </ul>

    <div id='text' do='zazen' attr='v_text'>
      <p>Lorem ipsum dolor sit amet, consectetuer elit....</p>
      <h3>some title</h3>
    </div>
  res: |
    <h1 id='main_title'>parc opening</h1>
    
    <ul>
      <li><a href='/oo/tag33.html'>Art</a></li>
      <li><a href='/oo/tag34.html'>News list</a></li>
    </ul>
    
    <div id='text'><p>We are glad to announce the opening of our new project !</p>
    
    
    	<p>You are all invited to <strong>Romanel</strong> for a great party this weekend.</p></div>

summary:
  context:
    node: 'zena'
  src: "<z:summary/>"
  res: "<div id='v_summary11' class='zazen'></div>"

summary_exists:
  src: "<z:summary/>"
  res: "<div id='v_summary22' class='zazen'><p>status summary</p></div>"

empty_summary:
  src: "<z:summary text=''/>"
  res: "<div id='v_summary22' class='zazen'></div>"

summary_or_text_has_summary:
  src: "<z:summary or='v_text'/>"
  res: "<div id='v_summary22' class='zazen'><p>status summary</p></div>"

summary_or_text_no_summary:
  context:
    node: 'zena'
  src: "<z:summary or='v_text'/>"
  res: "<div id='v_text11' class='zazen'><p>This is the root of your peaceful tests.</p></div>"

ztag_form_and_form:
  src: |
    <z:form>
      <li class='inline_form'>
        <form>
          <input type='hidden' name='node[parent_id]' value='' do='void' set_value='[id]'/>
          <z:input type='select' attr='klass' options='Page,Section,Project'/>
          <input type='text' name='node[v_title]' value='' size='25'/>
          <input type="submit" class="btn_validate" value='validate' do='void' tset_value='validate'/>
        </form>
      </li>
    </z:form>
  tem: ".."