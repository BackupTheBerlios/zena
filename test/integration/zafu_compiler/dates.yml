default:
  context:
    lang: 'en'
    visitor: 'ant'
    node: 'letter'
  src: "simple text"
  tem: "simple text"
  res: "simple text"

date:
  context:
    visitor: ant
    node: 'letter'
    lang: 'fr'
  src: "<r:void set_date='log_at'>nouvelles <r:show eval='trans(date.strftime(\"%B\"))'/> <r:show eval='date' format='%Y'/>: <r:notes where='log_at.month eq #{date}.month' in='site' do='each' join=', ' do='node_name'/></r:void>"
  res: "nouvelles avril 2006: letter"

select_date_attr:
  src: "<p do='void' set_date='log_at'><span do='show' eval='date.year'/></p>"
  tem: "<p><span><%= (@node.log_at ? @node.log_at.year : nil) %></span></p>"
  res: '<p><span>2006</span></p>'

date_in_link:
  src: "<r:link y='#{log_at.year}'/>"
  tem: "<a href='<%= zen_path(@node, {:y => \"#{(@node.log_at ? @node.log_at.year : nil)}\"}) %>'><%= @node.prop['title'] %></a>"

log_at:
  context:
    node: 'status'
  eval: 'log_at.year'
  tem: '<%= (@node.log_at ? @node.log_at.year : nil) %>'
  res: '' # no errors

# TypedString 'could_be_nil?' should propagate through 'date'
could_be_nil:
  context:
    node: 'status'
  src: "*<r:void set_date='log_at'><r:eval>date.year</r:eval></r:void>*"
  tem: "*<%= (@node.log_at ? @node.log_at.year : nil) %>*"
  res: '**' # no errors

uses_datebox:
  src: "<r:uses_datebox/>"
  tem: "/<script.*calendar.js.*calendar-setup.js.*calendar-en-utf8.js.*calendar-brown.css.*DEF_DATE_FORMAT.*%Y-%m-%d %H:%M.*FIRST_DAY.*0/"

uses_datebox_missing_lang:
  # should default to 'en'
  # visitor.lang = 'io' set in ZafuCompilerTest
  src: "<r:uses_datebox/>"
  tem: "/calendar/lang/calendar-en-utf8.js/"

show_date_foo:
  context:
    date: '2010-05-16'
    lang: fr
  src: "<r:show eval='date' format='%A %d.%m.%Y'/>"
  tem: "/main_date/"
  res: 'dimanche 16.05.2010'