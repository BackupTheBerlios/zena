<% @depth ||=0; @depth += 1 -%>
<li <%= 'class="sub"' if @depth > 1 %>><%= link_to menu.name, :prefix => prefix, :controller => 'main', :action=>'show', :path=>menu.fullpath %>
    <% if (menu.pages != []) && (@depth < 4) -%>
    <ul>
    <%= render_to_string( :partial=>'main/menu', :collection=>menu.pages ) %>
    </ul>
    <% end -%>
</li>
<% @depth -= 1 -%>